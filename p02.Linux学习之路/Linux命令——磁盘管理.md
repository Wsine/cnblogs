# Linux命令——磁盘管理

### 命令df

> 作用：查看已挂载磁盘的总容量、使用容量、剩余容量等
> 参数：`-i`，查看inodes的使用状况
> 参数：`-h`，使用合适的单位显示（推荐）

### 命令du

> 作用：查看某个目录或者文件所占空间的大小
> 参数：`-a`，列出全部文件和目录
> 参数：`-h`，使用合适的单位显示（推荐）
> 参数：`-s`，只列出总和

### 命令fdisk

> 作用：磁盘划分工具
> 格式：`fdisk [选项] [设备名称]`
> 参数：`-l`，后不跟设备名称，列出全部磁盘设备及其分区
> 示例：`fdisk -l /dev/sda`

**说明**

进入该命令的模式后，有较多的命令可选，说明一下常用的

*m*：列出帮助菜单
*p*：打印当前磁盘的分区情况
*n*：建立一个新的分区
*w*：保存
*q*：退出
*d*：删除一个分区

关于主分区和逻辑分区及其数量问题，这里就不探讨了

### 命令mke2fs

> 作用：格式化分区
> 格式：`mke2fs [选项] [磁盘分区]`
> 参数：`-b`，设定块的大小，需为1024的整数倍，不建议超过4096，一般默认就好
> 参数：`-i`，设定inode的大小
> 参数：`-N`，设定inode的数量
> 参数：`-c`，格式化前检测一下磁盘是否有问题（降低格式化速度）
> 参数：`-L`，预设该分区的标签（常用）
> 参数：`-t`，指定文件系统的类型，后跟ext2、ext3或ext4（常用）
> 示例：`mke2fs -t ext4 -L WORK /dev/sda5`

### 命令e2label

> 作用：查看或修改分区的标签
> 示例：`e2label /dev/sda5`，查看分区标签
> 示例：`e2label /dev/sda5 WORK`，修改分区标签

### 命令mount

> 作用：挂载磁盘分区
> 格式：`mount [选项] 分区标识 挂载点`
> 参数：`-a`，把/etc/fstab中出现的所用磁盘分区挂载
> 参数：`-t`，指定挂载的分区类型，默认不指定会自动识别
> 参数：`-o`，指定挂载的分区特性，下面说明特性
> 示例：`# mkdir /newdir`，在/目录创建文件夹
> 示例：`# mount /dev/sdb5 /newdir`，挂载sdb5到/newdir上

**/etc/fstab配置文件说明**

这个文件显示了系统启动时需要挂载的各个分区，系统启动时会自动挂载到相应的挂载点。`mount -a`命令也是根据这份文件挂载。

- 第一列：分区标识，可以是分区名、分区LABEL、分区的UUID
- 第二列：挂载点
- 第三列：分区的格式
- 第四列：挂载参数，一般写default即可
- 第五列：表示是否被dump备份，1表示备份，0表示不备份
- 第六列：表示是否开机自检，1表示高优先级自检，2表示低优先级自检，0表示不自检

**挂载参数说明**

- async/sync：表示与磁盘和内存不同步/同步
- auto/noauto：表示开机自动挂载/不自动挂载
- default：默认值，包含rw,suid,dev,exec,auto,nouser,async
- ro：表示按只读权限挂载
- rw：表示按可读可写权限挂载
- exec/noexec：表示允许/不允许可执行文件执行
- user/nouser：表示运行/不允许root外的其他用户挂载分区
- suid/nosuid：表示运行/不允许分区有suid属性
- usrquota：表示启动用户的磁盘配额模式
- grquota：表示启动群组的磁盘配额模式

### 命令unmount

> 作用：卸载挂载点
> 格式：`unmount [选项] 挂载点/分区名`
> 参数：`-l`，当前目录在挂载点上时使用

### 增加虚拟内存

1. 建立一个swapfile
    `dd if=/dev/zero of=/tmp/newdisk bs=4k count=10240`
    if是指定输入源，/dev/zero不断提供0
    of是指定目标文件，即虚拟内存文件
    bs定义块的大小
    count定义块的数量
2. 格式化为swap格式
    `mkswap -f /tmp/newdisk`
3. 挂载为虚拟内存
    `swapon /tmp/newdisk`
4. 查看内存的使用情况
    `free -m`